# Tasks

| Date | Task | Implementation Details | Remarks |
| --- | --- | --- | --- |
| 2024-05-07 | Document current SLAC, IPv6, TCP, and HLC status | Added `docs/SLAC_Assessment.md` capturing executive summary, flow description, gaps, remediation plan, CCS2 considerations, and TODO list exactly as requested. | Serves as baseline reference for future CCS2 DC work. |
| 2024-05-07 | Harden SLAC + transport stack for CCS2 readiness | Added adaptive SLAC timers/retries, consistent frame lengths, NMK-derived NID, and error handling; rewrote IPv6/TCP parsing with checksum fixes, hop-limit 255, V2GTP validation, TCP MSS/retransmit/idle/FIN-RST handling, plus DIN CableCheck→SessionStop sequence with CurrentDemand loop and MeteringReceipt responses. | See `src/main.cpp`, `src/ipv6.cpp`, `src/tcp.cpp` for implementation details. |
| 2024-05-07 | Integrate CP/PWM sensing, contactor control, and Maxwell CAN DC module | Ported robust CP measurement, PWM + contactor logic into `src/cp_control.cpp`; added MCP2515-based Maxwell driver in `src/dc_can.cpp` with ramp/polling; wired both into main Timer task and DIN HLC (PowerDelivery/CurrentDemand) so DC commands drive CAN modules and contactor state. | Requires MCP2515 wiring per `platformio.ini` build flags. |
| 2024-05-07 | Author CCS2 DC integration plan (DIN, ISO-2, ISO-20) | Added `docs/CCS2_DC_Integration_Plan.md` outlining transport migration to lwIP/TLS, libcbv2g/libiso15118 adoption, TLS/PKI strategy, DIN/DC execution completion, and phased action items for production readiness. | Serves as execution blueprint for full CCS2 DC stack. |
| 2024-05-08 | Kick off lwIP migration scaffolding | Created `docs/Implementation_Backlog.md` to track actionable items from the plan, added `lwip_bridge` stubs, and invoked them from `setup()`/`Timer20ms` so future lwIP/QCA integration can drop in without refactoring call sites. | NET-01 initialized; no functional change yet. |
| 2024-05-08 | Enable dual-framework toolchain (NET‑02) | Switched `platformio.ini` env to `framework = arduino, espidf`, added `app_main` shim + FreeRTOS tick update (`sdkconfig.esp32-s3-devkitc-1` to 1 kHz) so Arduino `setup/loop` run under IDF, and verified `pio run` succeeds. | Unlocks access to lwIP/esp-tls features for upcoming transport/TLS work. |
| 2024-05-08 | lwIP-based SDP server skeleton (NET‑03) | Refactored SDP payload builder (`buildSdpResponseFrame` / `handleSdpRequestBuffer`), added `sdp_server` task that listens on UDP/15118 via lwIP sockets, and wired it through `lwip_bridge`. Raw Ethernet path still works; socket server currently awaits future netif glue. | Provides socket-based entry point for SDP once QCA↔lwIP bridge is completed. |
| 2024-05-08 | lwIP TCP server + bridge (NET‑04) | Implemented `lwip_bridge_on_frame` + netif output to inject QCA frames into lwIP, added `tcp_socket_server` task that accepts IPv6 TCP/15118 connections, feeds payloads into `tcp_process_socket_payload`, and routes DIN responses through a socket send callback hooked in `addV2GTPHeaderAndTransmit`. Legacy custom TCP stack remains for fallback. | Plain DIN HLC can now run over lwIP sockets, paving the way for TLS. |
| 2025-11-12 | TLS transport enablement (TLS‑01/TLS‑02) | Enabled esp-tls server support (TLS1.2/1.3) with embedded test cert/key, added `tls_server` task on `TCP_TLS_PORT`, upgraded SDP negotiation + config (`sdkconfig`) to advertise TLS vs plain endpoints, and wired DIN socket plumbing to share tx/rx callbacks + session resets. | Completes Step‑1 transport foundation so DIN can operate over lwIP TCP or TLS. |
| 2025-11-13 | ISO‑2 scaffolding + PKI CLI (HLC‑02 / PKI‑01 follow-on) | Swapped to libcbv2g for EXI, added ISO‑2 session stubs (SAP detection, SessionSetupRes, ServiceDiscoveryRes, PaymentServiceSelectionRes) with graceful fallbacks, introduced a Preferences-backed PKI CLI (`pki set|get <cert|key|ca> <base64>`) that feeds `pki_store` and live-reloads credentials, and documented the workflow in CCS2 plan/backlog. | Sets the stage for full ISO‑2/DC execution while enabling certificate provisioning without reflashing. |
| 2025-11-12 | EXI migration + PKI store (EXI‑01/02, PKI‑01) | Vendored `libcbv2g`, removed the legacy `projectExiConnector` tree, reworked the DIN/SAP FSM to encode/decode through cbV2G bitstreams, and added a LittleFS-backed PKI store feeding `tls_credentials` so the esp‑tls server loads on-device certs/keys/roots (fallback to embedded dev PEM if absent). | EXI handling is now production-grade and TLS material can be rotated without rebuilding firmware. |
| 2025-11-13 | ISO‑2 DC execution + remote PKI provisioning | Extended `src/tcp.cpp` ISO branch to cover PaymentDetails → SessionStop (DC_EVSEStatus, setpoints, metering) using the cp/dc HAL, added helper utilities to keep EVSE status in sync with Maxwell CAN telemetry, and introduced a JSON RPC (`type:"pki"`) alongside the CLI in `src/main.cpp` so certificates/keys/roots can be updated programmatically. Docs/backlog updated to reflect HLC‑01/02 completion. | ISO EVs can now stay in session through CurrentDemand, and PKI operations are scriptable over the diagnostics channel. |
| 2025-11-14 | ISO‑20 scaffolding + diagnostics hardening | Added `src/iso15118_dc.cpp`/`include/iso15118_dc.h` with `iso15118::TbdController` wiring (guarded by `ISO20_ENABLE`/`HAVE_LIBISO15118`), mapped callbacks to the existing HAL, introduced ISO watchdog timers (`ISO_STATE_TIMEOUT_MS`) in `src/tcp.cpp`, and locked PKI JSON/CLI endpoints behind `diag auth` tokens defined in `evse_config.h`. Documentation/backlog now tracks the ISO‑20 enablement path. | Establishes the hook points for libiso15118 DC sessions and closes the gap on negative-test coverage + diagnostics authentication. |
| 2025-11-15 | Embedded libiso15118 port + ISO watchdog retries | Vendored the ISO-20 controller into `lib/libiso15118/`, implemented an ESP32-ready `TbdController` that reuses the HAL callbacks from EvseV2G, provided sample PEMs under `certs/iso20/`, enabled the build via `HAVE_LIBISO15118`/`ISO20_ENABLE`, and upgraded the ISO watchdog with retry counters/log hooks in `src/tcp.cpp`. | ISO‑20 now runs on-device without Linux dependencies and the watchdog emits deterministic telemetry for automated negative tests. |
| 2025-11-15 | EVSE-aligned unit tests | Refactored diagnostic auth + ISO watchdog logic into dedicated modules and added Unity-based test coverage under `test/test_diag_iso`, mirroring the behavior validated in `temp/everest-core/modules/EVSE/EvseV2G/tests`. README documents `platformio test` usage. | Provides a harsh regression suite to keep token handling and watchdog fatal paths stable on ESP32 hardware. |
